{"version":3,"file":"ef12d65722adf2df502f.chunk.js","mappings":"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","sources":["webpack://superset/./src/dashboard/components/nativeFilters/FilterBar/keyValue.tsx","webpack://superset/./src/dashboard/styles.ts","webpack://superset/./src/dashboard/containers/DashboardPage.tsx","webpack://superset/./src/dashboard/util/injectCustomCss.ts","webpack://superset/./src/hooks/apiResources/charts.ts","webpack://superset/./src/hooks/apiResources/dashboards.ts","webpack://superset/./src/hooks/apiResources/queryValidations.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SupersetClient, logging } from '@superset-ui/core';\nimport { DashboardPermalinkValue } from 'src/dashboard/types';\n\nconst assembleEndpoint = (\n  dashId: string | number,\n  key?: string | null,\n  tabId?: string,\n) => {\n  let endpoint = `api/v1/dashboard/${dashId}/filter_state`;\n  if (key) {\n    endpoint = endpoint.concat(`/${key}`);\n  }\n  if (tabId) {\n    endpoint = endpoint.concat(`?tab_id=${tabId}`);\n  }\n  return endpoint;\n};\n\nexport const updateFilterKey = (\n  dashId: string,\n  value: string,\n  key: string,\n  tabId?: string,\n) =>\n  SupersetClient.put({\n    endpoint: assembleEndpoint(dashId, key, tabId),\n    jsonPayload: { value },\n  })\n    .then(r => r.json.message)\n    .catch(err => {\n      logging.error(err);\n      return null;\n    });\n\nexport const createFilterKey = (\n  dashId: string | number,\n  value: string,\n  tabId?: string,\n) =>\n  SupersetClient.post({\n    endpoint: assembleEndpoint(dashId, undefined, tabId),\n    jsonPayload: { value },\n  })\n    .then(r => r.json.key as string)\n    .catch(err => {\n      logging.error(err);\n      return null;\n    });\n\nexport const getFilterValue = (dashId: string | number, key?: string | null) =>\n  SupersetClient.get({\n    endpoint: assembleEndpoint(dashId, key),\n  })\n    .then(({ json }) => JSON.parse(json.value))\n    .catch(err => {\n      logging.error(err);\n      return null;\n    });\n\nexport const getPermalinkValue = (key: string) =>\n  SupersetClient.get({\n    endpoint: `/api/v1/dashboard/permalink/${key}`,\n  })\n    .then(({ json }) => json as DashboardPermalinkValue)\n    .catch(err => {\n      logging.error(err);\n      return null;\n    });\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { css, SupersetTheme } from '@superset-ui/core';\n\nexport const headerStyles = (theme: SupersetTheme) => css`\n  body {\n    h1 {\n      font-weight: ${theme.typography.weights.bold};\n      line-height: 1.4;\n      font-size: ${theme.typography.sizes.xxl}px;\n      letter-spacing: -0.2px;\n      margin-top: ${theme.gridUnit * 3}px;\n      margin-bottom: ${theme.gridUnit * 3}px;\n    }\n\n    h2 {\n      font-weight: ${theme.typography.weights.bold};\n      line-height: 1.4;\n      font-size: ${theme.typography.sizes.xl}px;\n      margin-top: ${theme.gridUnit * 3}px;\n      margin-bottom: ${theme.gridUnit * 2}px;\n    }\n\n    h3,\n    h4,\n    h5,\n    h6 {\n      font-weight: ${theme.typography.weights.bold};\n      line-height: 1.4;\n      font-size: ${theme.typography.sizes.l}px;\n      letter-spacing: 0.2px;\n      margin-top: ${theme.gridUnit * 2}px;\n      margin-bottom: ${theme.gridUnit}px;\n    }\n  }\n`;\n\nexport const filterCardPopoverStyle = (theme: SupersetTheme) => css`\n  .filter-card-popover {\n    width: 240px;\n    padding: 0;\n    border-radius: 4px;\n\n    &.ant-popover-placement-bottom {\n      padding-top: ${theme.gridUnit}px;\n    }\n\n    &.ant-popover-placement-left {\n      padding-right: ${theme.gridUnit * 3}px;\n    }\n\n    .ant-popover-inner {\n      box-shadow: 0 0 8px rgb(0 0 0 / 10%);\n    }\n\n    .ant-popover-inner-content {\n      padding: ${theme.gridUnit * 4}px;\n    }\n\n    .ant-popover-arrow {\n      display: none;\n    }\n  }\n\n  .filter-card-tooltip {\n    &.ant-tooltip-placement-bottom {\n      padding-top: 0;\n      & .ant-tooltip-arrow {\n        top: -13px;\n      }\n    }\n  }\n`;\n\nexport const chartContextMenuStyles = (theme: SupersetTheme) => css`\n  .ant-dropdown-menu.chart-context-menu {\n    min-width: ${theme.gridUnit * 43}px;\n  }\n  .ant-dropdown-menu-submenu.chart-context-submenu {\n    max-width: ${theme.gridUnit * 60}px;\n    min-width: ${theme.gridUnit * 40}px;\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FC, useEffect, useMemo, useRef } from 'react';\nimport { Global } from '@emotion/react';\nimport { useHistory } from 'react-router-dom';\nimport {\n  CategoricalColorNamespace,\n  FeatureFlag,\n  getSharedLabelColor,\n  isFeatureEnabled,\n  SharedLabelColorSource,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport pick from 'lodash/pick';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useToasts } from 'src/components/MessageToasts/withToasts';\nimport Loading from 'src/components/Loading';\nimport {\n  useDashboard,\n  useDashboardCharts,\n  useDashboardDatasets,\n} from 'src/hooks/apiResources';\nimport { hydrateDashboard } from 'src/dashboard/actions/hydrate';\nimport { setDatasources } from 'src/dashboard/actions/datasources';\nimport injectCustomCss from 'src/dashboard/util/injectCustomCss';\nimport setupPlugins from 'src/setup/setupPlugins';\n\nimport {\n  getItem,\n  LocalStorageKeys,\n  setItem,\n} from 'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { getFilterSets } from 'src/dashboard/actions/nativeFilters';\nimport { setDatasetsStatus } from 'src/dashboard/actions/dashboardState';\nimport {\n  getFilterValue,\n  getPermalinkValue,\n} from 'src/dashboard/components/nativeFilters/FilterBar/keyValue';\nimport { DashboardContextForExplore } from 'src/types/DashboardContextForExplore';\nimport shortid from 'shortid';\nimport { RootState } from '../types';\nimport { getActiveFilters } from '../util/activeDashboardFilters';\nimport {\n  chartContextMenuStyles,\n  filterCardPopoverStyle,\n  headerStyles,\n} from '../styles';\n\nexport const DashboardPageIdContext = React.createContext('');\n\nsetupPlugins();\nconst DashboardContainer = React.lazy(\n  () =>\n    import(\n      /* webpackChunkName: \"DashboardContainer\" */\n      /* webpackPreload: true */\n      'src/dashboard/containers/Dashboard'\n    ),\n);\n\nconst originalDocumentTitle = document.title;\n\ntype PageProps = {\n  idOrSlug: string;\n};\n\nconst getDashboardContextLocalStorage = () => {\n  const dashboardsContexts = getItem(\n    LocalStorageKeys.dashboard__explore_context,\n    {},\n  );\n  // A new dashboard tab id is generated on each dashboard page opening.\n  // We mark ids as redundant when user leaves the dashboard, because they won't be reused.\n  // Then we remove redundant dashboard contexts from local storage in order not to clutter it\n  return Object.fromEntries(\n    Object.entries(dashboardsContexts).filter(\n      ([, value]) => !value.isRedundant,\n    ),\n  );\n};\n\nconst updateDashboardTabLocalStorage = (\n  dashboardPageId: string,\n  dashboardContext: DashboardContextForExplore,\n) => {\n  const dashboardsContexts = getDashboardContextLocalStorage();\n  setItem(LocalStorageKeys.dashboard__explore_context, {\n    ...dashboardsContexts,\n    [dashboardPageId]: dashboardContext,\n  });\n};\n\nconst useSyncDashboardStateWithLocalStorage = () => {\n  const dashboardPageId = useMemo(() => shortid.generate(), []);\n  const dashboardContextForExplore = useSelector<\n    RootState,\n    DashboardContextForExplore\n  >(({ dashboardInfo, dashboardState, nativeFilters, dataMask }) => ({\n    labelColors: dashboardInfo.metadata?.label_colors || {},\n    sharedLabelColors: dashboardInfo.metadata?.shared_label_colors || {},\n    colorScheme: dashboardState?.colorScheme,\n    chartConfiguration: dashboardInfo.metadata?.chart_configuration || {},\n    nativeFilters: Object.entries(nativeFilters.filters).reduce(\n      (acc, [key, filterValue]) => ({\n        ...acc,\n        [key]: pick(filterValue, ['chartsInScope']),\n      }),\n      {},\n    ),\n    dataMask,\n    dashboardId: dashboardInfo.id,\n    filterBoxFilters: getActiveFilters(),\n    dashboardPageId,\n  }));\n\n  useEffect(() => {\n    updateDashboardTabLocalStorage(dashboardPageId, dashboardContextForExplore);\n    return () => {\n      // mark tab id as redundant when dashboard unmounts - case when user opens\n      // Explore in the same tab\n      updateDashboardTabLocalStorage(dashboardPageId, {\n        ...dashboardContextForExplore,\n        isRedundant: true,\n      });\n    };\n  }, [dashboardContextForExplore, dashboardPageId]);\n  return dashboardPageId;\n};\n\nexport const DashboardPage: FC<PageProps> = ({ idOrSlug }: PageProps) => {\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const history = useHistory();\n  const dashboardPageId = useSyncDashboardStateWithLocalStorage();\n  const { addDangerToast } = useToasts();\n  const { result: dashboard, error: dashboardApiError } =\n    useDashboard(idOrSlug);\n  const { result: charts, error: chartsApiError } =\n    useDashboardCharts(idOrSlug);\n  const {\n    result: datasets,\n    error: datasetsApiError,\n    status,\n  } = useDashboardDatasets(idOrSlug);\n  const isDashboardHydrated = useRef(false);\n\n  const error = dashboardApiError || chartsApiError;\n  const readyToRender = Boolean(dashboard && charts);\n  const { dashboard_title, css, metadata, id = 0 } = dashboard || {};\n\n  // Filter sets depend on native filters\n  const filterSetEnabled =\n    isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET) &&\n    isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS);\n\n  useEffect(() => {\n    // mark tab id as redundant when user closes browser tab - a new id will be\n    // generated next time user opens a dashboard and the old one won't be reused\n    const handleTabClose = () => {\n      const dashboardsContexts = getDashboardContextLocalStorage();\n      setItem(LocalStorageKeys.dashboard__explore_context, {\n        ...dashboardsContexts,\n        [dashboardPageId]: {\n          ...dashboardsContexts[dashboardPageId],\n          isRedundant: true,\n        },\n      });\n    };\n    window.addEventListener('beforeunload', handleTabClose);\n    return () => {\n      window.removeEventListener('beforeunload', handleTabClose);\n    };\n  }, [dashboardPageId]);\n\n  useEffect(() => {\n    dispatch(setDatasetsStatus(status));\n  }, [dispatch, status]);\n\n  useEffect(() => {\n    // eslint-disable-next-line consistent-return\n    async function getDataMaskApplied() {\n      const permalinkKey = getUrlParam(URL_PARAMS.permalinkKey);\n      const nativeFilterKeyValue = getUrlParam(URL_PARAMS.nativeFiltersKey);\n      const isOldRison = getUrlParam(URL_PARAMS.nativeFilters);\n\n      let dataMask = nativeFilterKeyValue || {};\n      // activeTabs is initialized with undefined so that it doesn't override\n      // the currently stored value when hydrating\n      let activeTabs: string[] | undefined;\n      if (permalinkKey) {\n        const permalinkValue = await getPermalinkValue(permalinkKey);\n        if (permalinkValue) {\n          ({ dataMask, activeTabs } = permalinkValue.state);\n        }\n      } else if (nativeFilterKeyValue) {\n        dataMask = await getFilterValue(id, nativeFilterKeyValue);\n      }\n      if (isOldRison) {\n        dataMask = isOldRison;\n      }\n\n      if (readyToRender) {\n        if (!isDashboardHydrated.current) {\n          isDashboardHydrated.current = true;\n          if (filterSetEnabled) {\n            // only initialize filterset once\n            dispatch(getFilterSets(id));\n          }\n        }\n        dispatch(\n          hydrateDashboard({\n            history,\n            dashboard,\n            charts,\n            activeTabs,\n            dataMask,\n          }),\n        );\n      }\n      return null;\n    }\n    if (id) getDataMaskApplied();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [readyToRender]);\n\n  useEffect(() => {\n    if (dashboard_title) {\n      document.title = dashboard_title;\n    }\n    return () => {\n      document.title = originalDocumentTitle;\n    };\n  }, [dashboard_title]);\n\n  useEffect(() => {\n    if (typeof css === 'string') {\n      // returning will clean up custom css\n      // when dashboard unmounts or changes\n      return injectCustomCss(css);\n    }\n    return () => {};\n  }, [css]);\n\n  useEffect(() => {\n    const sharedLabelColor = getSharedLabelColor();\n    sharedLabelColor.source = SharedLabelColorSource.dashboard;\n    return () => {\n      // clean up label color\n      const categoricalNamespace = CategoricalColorNamespace.getNamespace(\n        metadata?.color_namespace,\n      );\n      categoricalNamespace.resetColors();\n      sharedLabelColor.clear();\n    };\n  }, [metadata?.color_namespace]);\n\n  useEffect(() => {\n    if (datasetsApiError) {\n      addDangerToast(\n        t('Error loading chart datasources. Filters may not work correctly.'),\n      );\n    } else {\n      dispatch(setDatasources(datasets));\n    }\n  }, [addDangerToast, datasets, datasetsApiError, dispatch]);\n\n  if (error) throw error; // caught in error boundary\n  if (!readyToRender || !isDashboardHydrated.current) return <Loading />;\n\n  return (\n    <>\n      <Global\n        styles={[\n          filterCardPopoverStyle(theme),\n          headerStyles(theme),\n          chartContextMenuStyles(theme),\n        ]}\n      />\n      <DashboardPageIdContext.Provider value={dashboardPageId}>\n        <DashboardContainer />\n      </DashboardPageIdContext.Provider>\n    </>\n  );\n};\n\nexport default DashboardPage;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nfunction createStyleElement(className: string) {\n  const style = document.createElement('style');\n  style.className = className;\n  style.type = 'text/css';\n  return style;\n}\n\n// The original, non-typescript code referenced `style.styleSheet`.\n// I can't find what sort of element would have a styleSheet property,\n// so have created this type to satisfy TS without changing behavior.\ntype MysteryStyleElement = {\n  styleSheet: {\n    cssText: string;\n  };\n};\n\nexport default function injectCustomCss(css: string) {\n  const className = 'CssEditor-css';\n  const head = document.head || document.getElementsByTagName('head')[0];\n  const style: HTMLStyleElement =\n    document.querySelector(`.${className}`) || createStyleElement(className);\n\n  if ('styleSheet' in style) {\n    (style as HTMLStyleElement & MysteryStyleElement).styleSheet.cssText = css;\n  } else {\n    style.innerHTML = css;\n  }\n\n  /**\n   * Ensures that the style applied is always the last.\n   *\n   * from: https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild\n   * The Node.appendChild() method adds a node to the end of the list of children\n   * of a specified parent node. If the given child is a reference to an existing\n   * node in the document, appendChild() moves it from its current position to the\n   * new position (there is no requirement to remove the node from its parent node\n   * before appending it to some other node).\n   */\n\n  head.appendChild(style);\n\n  return function removeCustomCSS() {\n    style.remove();\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport rison from 'rison';\nimport Chart from 'src/types/Chart';\nimport { useApiV1Resource, useTransformedResource } from './apiResources';\n\nfunction extractOwnerNames({ owners }: Chart) {\n  if (!owners) return null;\n  return owners.map(owner => `${owner.first_name} ${owner.last_name}`);\n}\n\nconst ownerNamesQuery = rison.encode({\n  columns: ['owners.first_name', 'owners.last_name'],\n  keys: ['none'],\n});\n\nexport function useChartOwnerNames(chartId: string) {\n  return useTransformedResource(\n    useApiV1Resource<Chart>(`/api/v1/chart/${chartId}?q=${ownerNamesQuery}`),\n    extractOwnerNames,\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Dashboard, Datasource, EmbeddedDashboard } from 'src/dashboard/types';\nimport { Chart } from 'src/types/Chart';\nimport { useApiV1Resource, useTransformedResource } from './apiResources';\n\nexport const useDashboard = (idOrSlug: string | number) =>\n  useTransformedResource(\n    useApiV1Resource<Dashboard>(`/api/v1/dashboard/${idOrSlug}`),\n    dashboard => ({\n      ...dashboard,\n      // TODO: load these at the API level\n      metadata:\n        (dashboard.json_metadata && JSON.parse(dashboard.json_metadata)) || {},\n      position_data:\n        dashboard.position_json && JSON.parse(dashboard.position_json),\n    }),\n  );\n\n// gets the chart definitions for a dashboard\nexport const useDashboardCharts = (idOrSlug: string | number) =>\n  useApiV1Resource<Chart[]>(`/api/v1/dashboard/${idOrSlug}/charts`);\n\n// gets the datasets for a dashboard\n// important: this endpoint only returns the fields in the dataset\n// that are necessary for rendering the given dashboard\nexport const useDashboardDatasets = (idOrSlug: string | number) =>\n  useApiV1Resource<Datasource[]>(`/api/v1/dashboard/${idOrSlug}/datasets`);\n\nexport const useEmbeddedDashboard = (idOrSlug: string | number) =>\n  useApiV1Resource<EmbeddedDashboard>(`/api/v1/dashboard/${idOrSlug}/embedded`);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { api, JsonResponse } from './queryApi';\n\nexport type FetchValidationQueryParams = {\n  dbId?: string | number;\n  schema?: string;\n  sql: string;\n  templateParams?: string;\n};\n\ntype ValidationResult = {\n  end_column: number | null;\n  line_number: number | null;\n  message: string | null;\n  start_column: number | null;\n};\n\nconst queryValidationApi = api.injectEndpoints({\n  endpoints: builder => ({\n    queryValidations: builder.query<\n      ValidationResult[],\n      FetchValidationQueryParams\n    >({\n      providesTags: ['QueryValidations'],\n      query: ({ dbId, schema, sql, templateParams }) => {\n        let template_params = templateParams;\n        try {\n          template_params = JSON.parse(templateParams || '');\n        } catch (e) {\n          template_params = undefined;\n        }\n        const postPayload = {\n          schema,\n          sql,\n          ...(template_params && { template_params }),\n        };\n        return {\n          method: 'post',\n          endpoint: `/api/v1/database/${dbId}/validate_sql/`,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(postPayload),\n          transformResponse: ({ json }: JsonResponse) => json.result,\n        };\n      },\n    }),\n  }),\n});\n\nexport const { useQueryValidationsQuery } = queryValidationApi;\n"],"names":["assembleEndpoint","dashId","key","tabId","endpoint","concat","updateFilterKey","value","SupersetClient","put","jsonPayload","then","r","json","message","catch","err","logging","error","createFilterKey","post","undefined","getFilterValue","get","_ref","JSON","parse","getPermalinkValue","_ref2","headerStyles","theme","css","typography","weights","bold","sizes","xxl","gridUnit","xl","l","filterCardPopoverStyle","chartContextMenuStyles","DashboardPageIdContext","React","setupPlugins","DashboardContainer","originalDocumentTitle","document","title","getDashboardContextLocalStorage","dashboardsContexts","getItem","LocalStorageKeys","dashboard__explore_context","Object","fromEntries","entries","filter","isRedundant","updateDashboardTabLocalStorage","dashboardPageId","dashboardContext","setItem","DashboardPage","_ref4","idOrSlug","useTheme","dispatch","useDispatch","history","useHistory","useSyncDashboardStateWithLocalStorage","useMemo","shortid","dashboardContextForExplore","useSelector","_dashboardInfo$metada","_dashboardInfo$metada2","_dashboardInfo$metada3","dashboardInfo","dashboardState","nativeFilters","dataMask","labelColors","metadata","label_colors","sharedLabelColors","shared_label_colors","colorScheme","chartConfiguration","chart_configuration","filters","reduce","acc","_ref3","filterValue","pick","dashboardId","id","filterBoxFilters","getActiveFilters","useEffect","addDangerToast","useToasts","result","dashboard","dashboardApiError","useDashboard","charts","chartsApiError","useDashboardCharts","datasets","datasetsApiError","status","useDashboardDatasets","isDashboardHydrated","useRef","readyToRender","Boolean","dashboard_title","filterSetEnabled","isFeatureEnabled","FeatureFlag","DASHBOARD_NATIVE_FILTERS_SET","DASHBOARD_NATIVE_FILTERS","handleTabClose","window","addEventListener","removeEventListener","setDatasetsStatus","async","permalinkKey","getUrlParam","URL_PARAMS","nativeFilterKeyValue","nativeFiltersKey","isOldRison","activeTabs","permalinkValue","state","current","getFilterSets","hydrateDashboard","getDataMaskApplied","injectCustomCss","sharedLabelColor","getSharedLabelColor","source","SharedLabelColorSource","CategoricalColorNamespace","getNamespace","color_namespace","resetColors","clear","t","setDatasources","___EmotionJSX","Global","styles","Provider","Loading","className","head","getElementsByTagName","style","querySelector","createElement","type","createStyleElement","styleSheet","cssText","innerHTML","appendChild","remove","extractOwnerNames","owners","map","owner","first_name","last_name","ownerNamesQuery","rison","columns","keys","useChartOwnerNames","chartId","useTransformedResource","useApiV1Resource","json_metadata","position_data","position_json","queryValidationApi","api","injectEndpoints","endpoints","builder","queryValidations","query","providesTags","dbId","schema","sql","templateParams","template_params","e","postPayload","method","headers","body","stringify","transformResponse","useQueryValidationsQuery"],"sourceRoot":""}